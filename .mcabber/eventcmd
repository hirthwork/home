#! /bin/sh
account=$1
event=$2
arg1=$3
arg2=$4
filename=$5
# Note that the 4th argument is only provided for incoming messages
# and when 'event_log_files' is set.

if [ $event = "MSG" ]; then
    case "$arg1" in
        IN)
            # Incoming message from buddy $arg2
            notify-send -i dialog-information -t 5000 -h int:transient:1 "$arg2" "$(cat $filename)"
            if [ -n "$filename" -a -f "$filename" ]; then
                # We could process filename here...
                /bin/rm $filename
            fi
            ;;
        MUC)
            # Incoming message from buddy $arg2
            notify-send -i dialog-information -t 5000 -h int:transient:1 "$arg2" "$(cat $filename)"
            if [ -n "$filename" -a -f "$filename" ]; then
                # We could process filename here...
                /bin/rm $filename
            fi
            ;;
    esac
elif [ $event = "UNREAD" ]; then
    # $arg1 contains 4 numbers separated with space chars:
    # Nr of unread buffers, nr of unread buffers with attention sign,
    # nr of MUC unread buffers, nr of MUC unread buffers with attention sign.
    count=`echo $arg1|grep -o "^[0-9]*"`
    if [ $count -eq 0 ]
    then
        rm $HOME/.mcabber/$account/state 2>/dev/null
    else
        echo $count >$HOME/.mcabber/$account/state
    fi
    sh $HOME/.dwm.update
fi
