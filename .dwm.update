#!/bin/sh

test -f $DWM_UPDATE_MARK && exit 0

touch $DWM_UPDATE_MARK
status=`$HOME/.status`

cpu=
if [ -f $DWM_CPU_USAGE ]
then
    cpu="üíª`(echo -n 100- ;tail -n6 $DWM_CPU_USAGE|head -n1|sed 's/.*ni,//;s/ id,.*//;s/,/./g')|calc -p`%"
fi

mem=$(free -m|head -n2|tail -n1|awk 'BEGIN{_[0]="‚óã";_[1]="‚óî";_[2]="‚óë";_[3]="‚óï";_[4]="‚è∫"}{print _[int($3 * 5 / $2)]}')
if [ -f /sys/class/power_supply/BAT0/capacity ]
then
    bat="‚ö°$(cat /sys/class/power_supply/BAT0/capacity)% "
else
    bat=
fi
status="$status $mem$cpu $bat$(date '+%R %a %F')"

xsetroot -name "$status"

if [ -x ~/.dwm.postupdate ]
then
    ~/.dwm.postupdate
fi

rm -f $DWM_UPDATE_MARK

